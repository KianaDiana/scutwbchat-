# ScutChat 测试手册

## 目录

1. [测试概述](#测试概述)
2. [测试环境准备](#测试环境准备)
3. [功能测试用例](#功能测试用例)
4. [性能测试](#性能测试)
5. [安全测试](#安全测试)
6. [兼容性测试](#兼容性测试)
7. [回归测试](#回归测试)
8. [测试报告模板](#测试报告模板)

---

## 测试概述

### 测试目标

- 验证所有功能模块正常工作
- 确保系统稳定性和可靠性
- 验证安全机制有效
- 检查性能和兼容性
- 发现并修复潜在bug

### 测试范围

- **功能测试**：用户登录、消息发送、消息接收、管理员功能
- **性能测试**：并发用户、消息处理速度、文件读写性能
- **安全测试**：CSRF防护、XSS防护、输入验证
- **兼容性测试**：浏览器兼容性、PHP版本兼容性
- **异常测试**：错误处理、边界条件、异常情况

### 测试工具

- **浏览器**：Chrome、Firefox、Edge、Safari
- **API测试**：Postman、curl、浏览器开发者工具
- **性能测试**：Apache Bench (ab)、JMeter
- **代码检查**：PHP_CodeSniffer、PHPStan

---

## 测试环境准备

### 测试环境配置

#### 1. 本地测试环境

- **PHP版本**：5.4、7.0、7.4、8.0
- **Web服务器**：Apache 2.4 / Nginx 1.18
- **操作系统**：Windows 10 / Ubuntu 20.04 / macOS

#### 2. 测试数据准备

**清理测试数据**
```bash
# 删除消息文件
rm app/MSG.txt

# 清除Cookie（在浏览器中清除）
# Chrome: F12 → Application → Cookies → Clear All
```

**准备测试用户**
- 普通用户：测试昵称 "测试用户1"、"测试用户2"
- 管理员：通过 `?admin` 参数访问

#### 3. 测试前检查清单

- [ ] Web服务器正常运行
- [ ] PHP版本符合要求
- [ ] app目录有写入权限
- [ ] 浏览器Cookie已清除
- [ ] 消息文件已清理
- [ ] 网络连接正常

---

## 功能测试用例

### 测试用例1：用户登录功能

#### TC-001：首次访问登录

**测试步骤**：
1. 清除浏览器Cookie
2. 访问 `http://localhost/scutchat/index.php`
3. 观察页面显示

**预期结果**：
- 页面显示昵称输入框
- 显示"进♂入"按钮
- 输入框提示文字为"请随便输入昵称.."

**实际结果**：□ 通过  □ 失败

**备注**：

---

#### TC-002：输入昵称登录

**测试步骤**：
1. 在昵称输入框输入"测试用户"
2. 点击"进♂入"按钮
3. 观察页面变化

**预期结果**：
- 页面跳转到聊天界面
- 显示聊天消息区域
- 显示消息输入框和发送按钮
- 系统消息显示"测试用户加入聊天"
- Cookie中保存用户信息

**实际结果**：□ 通过  □ 失败

**备注**：

---

#### TC-003：空昵称登录

**测试步骤**：
1. 在昵称输入框不输入任何内容（或为空）
2. 点击"进♂入"按钮
3. 观察页面变化

**预期结果**：
- 如果代码支持，应该生成随机昵称
- 或者显示错误提示（取决于具体实现）

**实际结果**：□ 通过  □ 失败

**备注**：

---

#### TC-004：长昵称登录

**测试步骤**：
1. 在昵称输入框输入超过5个字符的昵称（如"这是一个很长的昵称测试"）
2. 点击"进♂入"按钮
3. 检查实际保存的昵称

**预期结果**：
- 昵称被截断为5个字符
- 登录成功，使用截断后的昵称

**实际结果**：□ 通过  □ 失败

**备注**：

---

#### TC-005：已登录用户访问

**测试步骤**：
1. 完成一次登录
2. 刷新页面或重新访问 `index.php`
3. 观察页面显示

**预期结果**：
- 直接显示聊天界面，不再显示登录框
- 使用Cookie中保存的昵称

**实际结果**：□ 通过  □ 失败

**备注**：

---

### 测试用例2：消息发送功能

#### TC-006：发送普通消息

**测试步骤**：
1. 登录系统
2. 在消息输入框输入"这是一条测试消息"
3. 点击"发送"按钮
4. 观察消息显示

**预期结果**：
- 消息立即显示在聊天区域右侧（自己的消息）
- 显示用户昵称和消息内容
- 输入框清空
- 消息保存到MSG.txt文件

**实际结果**：□ 通过  □ 失败

**备注**：

---

#### TC-007：发送空消息

**测试步骤**：
1. 登录系统
2. 在消息输入框不输入任何内容
3. 点击"发送"按钮

**预期结果**：
- 消息不发送
- 输入框保持为空
- 无错误提示（或显示提示）

**实际结果**：□ 通过  □ 失败

**备注**：

---

#### TC-008：发送超长消息

**测试步骤**：
1. 登录系统
2. 输入超过140个字符的消息（如重复输入"测试"100次）
3. 点击"发送"按钮
4. 检查实际发送的消息长度

**预期结果**：
- 消息被截断为140个字符
- 只发送前140个字符

**实际结果**：□ 通过  □ 失败

**备注**：

---

#### TC-009：快速连续发送消息

**测试步骤**：
1. 登录系统
2. 快速连续点击"发送"按钮（间隔小于3秒）
3. 观察发送按钮状态

**预期结果**：
- 第一次点击发送成功
- 按钮变为禁用状态（disabled）
- 3秒后按钮恢复可用
- 3秒内的点击被忽略

**实际结果**：□ 通过  □ 失败

**备注**：

---

#### TC-010：发送HTML标签消息

**测试步骤**：
1. 登录系统
2. 输入包含HTML标签的消息：`<script>alert('xss')</script>测试`
3. 点击"发送"按钮
4. 观察消息显示

**预期结果**：
- HTML标签被过滤，显示为纯文本
- 不执行JavaScript代码
- 消息正常显示，无XSS攻击

**实际结果**：□ 通过  □ 失败

**备注**：

---

#### TC-011：发送特殊字符消息

**测试步骤**：
1. 登录系统
2. 输入包含特殊字符的消息：`!@#$%^&*()_+-=[]{}|;':",./<>?`
3. 点击"发送"按钮
4. 观察消息显示

**预期结果**：
- 特殊字符正常显示
- 消息正确保存和显示

**实际结果**：□ 通过  □ 失败

**备注**：

---

#### TC-012：发送中文消息

**测试步骤**：
1. 登录系统
2. 输入中文消息："你好，这是一条中文测试消息"
3. 点击"发送"按钮
4. 观察消息显示

**预期结果**：
- 中文正常显示，无乱码
- 消息正确保存

**实际结果**：□ 通过  □ 失败

**备注**：

---

### 测试用例3：消息接收功能

#### TC-013：自动接收新消息

**测试步骤**：
1. 使用两个浏览器窗口（或两个浏览器）同时登录不同用户
2. 用户A发送一条消息
3. 观察用户B的界面

**预期结果**：
- 用户B在1-2秒内自动收到新消息
- 消息显示在聊天区域左侧（他人消息）
- 显示发送者昵称和消息内容
- 聊天区域自动滚动到底部

**实际结果**：□ 通过  □ 失败

**备注**：

---

#### TC-014：多用户同时发送消息

**测试步骤**：
1. 使用3个浏览器窗口，登录3个不同用户
2. 3个用户几乎同时发送消息
3. 观察所有用户的界面

**预期结果**：
- 所有消息都能正确保存
- 所有用户都能收到其他人的消息
- 消息顺序正确
- 无消息丢失

**实际结果**：□ 通过  □ 失败

**备注**：

---

#### TC-015：历史消息加载

**测试步骤**：
1. 发送多条消息（10条以上）
2. 刷新页面
3. 观察消息加载

**预期结果**：
- 页面加载后显示历史消息
- 显示最近的消息（最多50条）
- 消息顺序正确
- 消息内容完整

**实际结果**：□ 通过  □ 失败

**备注**：

---

#### TC-016：消息文件为空时的处理

**测试步骤**：
1. 删除或清空MSG.txt文件
2. 刷新页面
3. 观察页面显示

**预期结果**：
- 页面正常加载
- 聊天区域为空或显示提示
- 不出现错误

**实际结果**：□ 通过  □ 失败

**备注**：

---

### 测试用例4：管理员功能

#### TC-017：管理员清空消息

**测试步骤**：
1. 以管理员身份登录（URL中添加`?admin`参数）
2. 发送多条消息
3. 发送"clear"消息
4. 观察聊天区域

**预期结果**：
- 发送"clear"后，聊天区域被清空
- MSG.txt文件被清空
- 系统显示"rebot"消息（表示重置）

**实际结果**：□ 通过  □ 失败

**备注**：

---

#### TC-018：普通用户发送clear

**测试步骤**：
1. 以普通用户身份登录
2. 发送"clear"消息
3. 观察结果

**预期结果**：
- "clear"作为普通消息发送
- 聊天记录不被清空
- 消息正常显示在聊天区域

**实际结果**：□ 通过  □ 失败

**备注**：

---

### 测试用例5：异常情况处理

#### TC-019：文件写入权限不足

**测试步骤**：
1. 修改app目录权限为只读（chmod 555 app/）
2. 尝试发送消息
3. 观察错误处理

**预期结果**：
- 显示错误提示（或记录错误日志）
- 系统不崩溃
- 用户界面友好提示

**实际结果**：□ 通过  □ 失败

**备注**：

---

#### TC-020：网络中断时的处理

**测试步骤**：
1. 登录系统
2. 断开网络连接
3. 尝试发送消息
4. 观察错误提示

**预期结果**：
- 显示网络错误提示
- 长时间无响应后提示"长时间未收到消息"
- 提供"点击继续收取"按钮

**实际结果**：□ 通过  □ 失败

**备注**：

---

#### TC-021：服务器关闭时的处理

**测试步骤**：
1. 登录系统
2. 停止Web服务器
3. 尝试发送或接收消息
4. 观察错误处理

**预期结果**：
- 显示连接错误
- 不出现白屏或严重错误
- 提供友好的错误提示

**实际结果**：□ 通过  □ 失败

**备注**：

---

## 性能测试

### 测试场景1：单用户消息发送性能

**测试目标**：测试单用户连续发送消息的性能

**测试步骤**：
1. 登录系统
2. 使用脚本或手动快速发送100条消息
3. 记录发送时间和成功率

**性能指标**：
- 消息发送成功率：≥ 99%
- 平均发送延迟：< 500ms
- 100条消息发送总时间：< 60秒

**测试结果**：
```
发送消息数量：100条
成功：□ 条
失败：□ 条
总耗时：□ 秒
平均延迟：□ ms
```

---

### 测试场景2：并发用户测试

**测试目标**：测试多用户同时使用的性能

**测试步骤**：
1. 使用工具（如JMeter）模拟10个并发用户
2. 每个用户发送20条消息
3. 监控服务器资源使用

**性能指标**：
- 所有消息发送成功率：≥ 95%
- 服务器CPU使用率：< 80%
- 内存使用：< 512MB
- 无消息丢失或错乱

**测试结果**：
```
并发用户数：10
总消息数：200
成功：□ 条
失败：□ 条
CPU峰值：□ %
内存峰值：□ MB
```

---

### 测试场景3：消息文件大小对性能的影响

**测试目标**：测试MSG.txt文件大小对读取性能的影响

**测试步骤**：
1. 准备不同大小的消息文件（1KB、10KB、100KB、1MB）
2. 测试消息加载时间
3. 记录性能数据

**性能指标**：
- 1KB文件加载时间：< 100ms
- 10KB文件加载时间：< 200ms
- 100KB文件加载时间：< 500ms
- 1MB文件加载时间：< 2s

**测试结果**：
```
文件大小    加载时间    状态
1KB        □ ms        □ 通过/失败
10KB       □ ms        □ 通过/失败
100KB      □ ms        □ 通过/失败
1MB        □ ms        □ 通过/失败
```

---

### 测试场景4：轮询频率优化测试

**测试目标**：测试不同轮询间隔对性能和用户体验的影响

**测试步骤**：
1. 修改轮询间隔（1秒、3秒、5秒）
2. 测试消息接收延迟
3. 监控服务器请求数量

**性能指标**：
- 1秒轮询：消息延迟 < 2秒，服务器负载较高
- 3秒轮询：消息延迟 < 4秒，服务器负载中等
- 5秒轮询：消息延迟 < 6秒，服务器负载较低

**测试结果**：
```
轮询间隔    消息延迟    服务器请求/分钟    用户满意度
1秒        □ 秒        □ 次              □ 高/中/低
3秒        □ 秒        □ 次              □ 高/中/低
5秒        □ 秒        □ 次              □ 高/中/低
```

---

## 安全测试

### 测试场景1：CSRF攻击测试

**测试步骤**：
1. 登录系统，获取Token
2. 构造恶意请求（不使用Token或使用错误Token）
3. 尝试发送消息

**预期结果**：
- 无Token的请求被拒绝
- 错误Token的请求被拒绝
- 只有正确Token的请求才能发送消息

**测试结果**：□ 通过  □ 失败

---

### 测试场景2：XSS攻击测试

**测试步骤**：
1. 尝试发送包含JavaScript代码的消息：
   - `<script>alert('XSS')</script>`
   - `<img src=x onerror=alert('XSS')>`
   - `<svg onload=alert('XSS')>`
2. 观察消息显示

**预期结果**：
- 所有HTML标签被过滤
- JavaScript代码不执行
- 消息显示为纯文本

**测试结果**：□ 通过  □ 失败

---

### 测试场景3：SQL注入测试（如果使用数据库）

**测试步骤**：
1. 在输入框中输入SQL注入代码：
   - `' OR '1'='1`
   - `'; DROP TABLE messages; --`
2. 观察系统响应

**预期结果**：
- 如果使用数据库，应使用预处理语句
- 恶意代码被正确处理，不执行SQL命令

**测试结果**：□ 通过  □ 失败（如不使用数据库，标记为N/A）

---

### 测试场景4：文件路径遍历测试

**测试步骤**：
1. 尝试在消息中注入文件路径：
   - `../../../etc/passwd`
   - `..\..\..\windows\system32\config\sam`
2. 观察系统响应

**预期结果**：
- 文件路径被正确处理
- 无法访问系统敏感文件

**测试结果**：□ 通过  □ 失败

---

### 测试场景5：Cookie安全性测试

**测试步骤**：
1. 检查Cookie设置
2. 尝试修改Cookie值
3. 测试HttpOnly和Secure标志（如有设置）

**预期结果**：
- Cookie值验证有效
- 修改后的Cookie无效
- Cookie设置合理（路径、有效期）

**测试结果**：□ 通过  □ 失败

---

## 兼容性测试

### 浏览器兼容性测试

| 浏览器 | 版本 | 登录功能 | 发送消息 | 接收消息 | 总体评价 |
|--------|------|----------|----------|----------|----------|
| Chrome | 最新 | □ 通过/失败 | □ 通过/失败 | □ 通过/失败 | □ 通过/失败 |
| Firefox | 最新 | □ 通过/失败 | □ 通过/失败 | □ 通过/失败 | □ 通过/失败 |
| Edge | 最新 | □ 通过/失败 | □ 通过/失败 | □ 通过/失败 | □ 通过/失败 |
| Safari | 最新 | □ 通过/失败 | □ 通过/失败 | □ 通过/失败 | □ 通过/失败 |
| IE 11 | 11 | □ 通过/失败 | □ 通过/失败 | □ 通过/失败 | □ 通过/失败 |

---

### PHP版本兼容性测试

| PHP版本 | 运行状态 | 功能完整性 | 性能 | 备注 |
|---------|----------|------------|------|------|
| PHP 5.4 | □ 正常/异常 | □ 完整/缺失 | □ 良好/较差 | |
| PHP 7.0 | □ 正常/异常 | □ 完整/缺失 | □ 良好/较差 | |
| PHP 7.4 | □ 正常/异常 | □ 完整/缺失 | □ 良好/较差 | |
| PHP 8.0 | □ 正常/异常 | □ 完整/缺失 | □ 良好/较差 | |

---

### 移动设备兼容性测试

| 设备类型 | 操作系统 | 浏览器 | 登录 | 发送 | 接收 | 总体评价 |
|----------|----------|--------|------|------|------|----------|
| iPhone | iOS 14+ | Safari | □ | □ | □ | □ |
| Android | Android 10+ | Chrome | □ | □ | □ | □ |
| iPad | iOS 14+ | Safari | □ | □ | □ | □ |

---

## 回归测试

### 回归测试检查清单

每次代码更新后，执行以下关键测试用例：

- [ ] TC-002：输入昵称登录
- [ ] TC-006：发送普通消息
- [ ] TC-010：发送HTML标签消息（XSS防护）
- [ ] TC-013：自动接收新消息
- [ ] TC-017：管理员清空消息
- [ ] 安全测试场景1：CSRF攻击测试
- [ ] 安全测试场景2：XSS攻击测试

---

## 测试报告模板

### ScutChat 测试报告

**测试日期**：____年____月____日  
**测试人员**：________________  
**测试版本**：v____  
**测试环境**：________________

---

#### 测试摘要

- **测试用例总数**：____ 个
- **通过用例数**：____ 个
- **失败用例数**：____ 个
- **通过率**：____ %

---

#### 功能测试结果

| 功能模块 | 测试用例数 | 通过 | 失败 | 通过率 |
|----------|------------|------|------|--------|
| 用户登录 | ____ | ____ | ____ | ____ % |
| 消息发送 | ____ | ____ | ____ | ____ % |
| 消息接收 | ____ | ____ | ____ | ____ % |
| 管理员功能 | ____ | ____ | ____ | ____ % |
| 异常处理 | ____ | ____ | ____ | ____ % |

---

#### 性能测试结果

| 测试项 | 指标 | 预期值 | 实际值 | 状态 |
|--------|------|--------|--------|------|
| 消息发送延迟 | 平均延迟 | < 500ms | ____ ms | □ 通过/失败 |
| 并发用户 | 成功率 | ≥ 95% | ____ % | □ 通过/失败 |
| 文件加载 | 100KB文件 | < 500ms | ____ ms | □ 通过/失败 |

---

#### 安全测试结果

| 测试项 | 测试结果 | 备注 |
|--------|----------|------|
| CSRF防护 | □ 通过/失败 | |
| XSS防护 | □ 通过/失败 | |
| 输入验证 | □ 通过/失败 | |
| Cookie安全 | □ 通过/失败 | |

---

#### 兼容性测试结果

| 测试项 | 通过 | 失败 | 备注 |
|--------|------|------|------|
| 浏览器兼容性 | ____ | ____ | |
| PHP版本兼容性 | ____ | ____ | |
| 移动设备兼容性 | ____ | ____ | |

---

#### 发现的问题

| 问题编号 | 问题描述 | 严重程度 | 状态 | 备注 |
|----------|----------|----------|------|------|
| BUG-001 | | 高/中/低 | 待修复/已修复 | |
| BUG-002 | | 高/中/低 | 待修复/已修复 | |

---

#### 测试结论

**总体评价**：□ 通过  □ 有条件通过  □ 不通过

**主要问题**：
1. 
2. 
3. 

**建议**：
1. 
2. 
3. 

---

**测试人员签名**：________________  
**日期**：____年____月____日

---

## 附录

### 测试数据样例

#### 测试消息内容

```
普通消息：这是一条测试消息
长消息：这是一条很长的测试消息，用于测试消息长度限制功能，看看系统是否能正确处理超长消息的情况。
HTML标签：<script>alert('test')</script>测试消息
特殊字符：!@#$%^&*()_+-=[]{}|;':",./<>?
中文消息：你好，这是一条中文测试消息
空消息：（空内容）
```

#### 测试昵称

```
正常昵称：测试用户
长昵称：这是一个很长的测试昵称
特殊字符：test@#$%
中文昵称：张三
空昵称：（空内容）
```

---

**文档版本**：v1.0  
**最后更新**：2024年  
**维护者**：测试团队

